<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dynamic Binary Tree Game</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #020617;
        color: white;
        overflow: hidden;
    }

    #controls {
        padding: 12px;
        background: #020617;
        border-bottom: 1px solid #334155;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    button {
        background: #1e293b;
        color: white;
        border: 1px solid #334155;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
    }

    button:hover {
        background: #334155;
    }

    #game {
        width: 100vw;
        height: calc(100vh - 60px);
    }

    .node {
        cursor: pointer;
    }

    .node circle {
        stroke-width: 2;
    }

    .node.active circle {
        fill: #16a34a;
        stroke: #22c55e;
    }

    .node.inactive circle {
        fill: #020617;
        stroke: #64748b;
    }

    text {
        fill: white;
        font-size: 12px;
        text-anchor: middle;
        pointer-events: none;
    }

    line {
        stroke: #475569;
        stroke-width: 2;
    }
</style>
</head>

<body>

<div id="controls">
    <button onclick="createRoot()">Create Root</button>
    <button onclick="addLeft()">Add Left</button>
    <button onclick="addRight()">Add Right</button>
    <button onclick="toggleActive()">Toggle Active</button>
</div>

<svg id="game"></svg>

<script>
class Node {
    constructor(name, parent = null) {
        this.name = name;
        this.parent = parent;
        this.left = null;
        this.right = null;
        this.isActive = false;
        this.LeftCount = 0;
        this.RightCount = 0;
        this.points = 0;
        this.x = 0;
        this.y = 0;
    }
}

let root = null;
let selectedNode = null;
let nodeId = 1;

const svg = document.getElementById("game");

const CalculateNodes = (node) => {
    if (!node) return { total: 0 };

    const left = CalculateNodes(node.left);
    const right = CalculateNodes(node.right);

    node.LeftCount = left.total;
    node.RightCount = right.total;

    node.points = 0;
    if (node.isActive) {
        node.points = 1;
        if (node.LeftCount === node.RightCount && node.LeftCount > 0) {
            node.points += 1;
        }
    }

    return {
        total: left.total + right.total + (node.isActive ? 1 : 0)
    };
};

function createRoot() {
    root = new Node("Root");
    selectedNode = root;
    redraw();
}

function addLeft() {
    if (!selectedNode || selectedNode.left) return;
    selectedNode.left = new Node("N" + nodeId++, selectedNode);
    redraw();
}

function addRight() {
    if (!selectedNode || selectedNode.right) return;
    selectedNode.right = new Node("N" + nodeId++, selectedNode);
    redraw();
}

function toggleActive() {
    if (!selectedNode) return;
    selectedNode.isActive = !selectedNode.isActive;
    redraw();
}

/* -------- Layout Engine (Scalable) -------- */
function layoutTree(node, depth = 0, xMin = 0, xMax = svg.clientWidth) {
    if (!node) return;

    node.x = (xMin + xMax) / 2;
    node.y = depth * 90 + 60;

    layoutTree(node.left, depth + 1, xMin, node.x);
    layoutTree(node.right, depth + 1, node.x, xMax);
}

/* -------- Render -------- */
function redraw() {
    svg.innerHTML = "";
    if (!root) return;

    CalculateNodes(root);
    layoutTree(root);

    drawLinks(root);
    drawNodes(root);
}

function drawLinks(node) {
    if (!node) return;

    if (node.left) {
        drawLine(node, node.left);
        drawLinks(node.left);
    }
    if (node.right) {
        drawLine(node, node.right);
        drawLinks(node.right);
    }
}

function drawLine(a, b) {
    const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
    line.setAttribute("x1", a.x);
    line.setAttribute("y1", a.y);
    line.setAttribute("x2", b.x);
    line.setAttribute("y2", b.y);
    svg.appendChild(line);
}

function drawNodes(node) {
    if (!node) return;

    const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
    g.classList.add("node", node.isActive ? "active" : "inactive");

    const circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
    circle.setAttribute("cx", node.x);
    circle.setAttribute("cy", node.y);
    circle.setAttribute("r", 30);

    /* ---- TEXT: POINTS ---- */
    const pointsText = document.createElementNS("http://www.w3.org/2000/svg", "text");
    pointsText.setAttribute("x", node.x);
    pointsText.setAttribute("y", node.y - 4);
    pointsText.textContent = `P: ${node.points}`;

    /* ---- TEXT: LEFT / RIGHT ---- */
    const lrText = document.createElementNS("http://www.w3.org/2000/svg", "text");
    lrText.setAttribute("x", node.x);
    lrText.setAttribute("y", node.y + 12);
    lrText.setAttribute("font-size", "10");
    lrText.textContent = `L:${node.LeftCount} | R:${node.RightCount}`;

    g.appendChild(circle);
    g.appendChild(pointsText);
    g.appendChild(lrText);

    g.onclick = () => {
        selectedNode = node;
        redraw();
    };

    if (node === selectedNode) {
        circle.style.stroke = "#facc15";
        circle.style.strokeWidth = "3";
    }

    svg.appendChild(g);

    drawNodes(node.left);
    drawNodes(node.right);
}

</script>

</body>
</html>
